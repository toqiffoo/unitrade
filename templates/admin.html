<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UniTrade | Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-danger">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">UniTrade Admin Security</a>
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-light btn-sm">Exit to Dashboard</a>
    </div>
</nav>

<div class="container mt-5">
    <h2 class="mb-4">ðŸš© Reported Items</h2>
    
    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Item</th>
                        <th>Type</th>
                        <th>Reason</th>
                        <th>Reporter</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in reports %}
                    <tr id="row-{{ r.id }}" class="{{ 'table-secondary text-muted' if r.status != 'pending' else '' }}">
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="{{ r.item_image }}" width="40" height="40" class="rounded me-2" style="object-fit:cover;">
                                <strong>{{ r.item_name }}</strong>
                            </div>
                        </td>
                        <td><span class="badge bg-secondary">{{ r.item_type }}</span></td>
                        <td class="text-danger">{{ r.reason }}</td>
                        <td>{{ r.reporter_email }}</td>
                        <td>
                            {% if r.status == 'pending' %}
                                <span class="badge bg-warning text-dark">Pending</span>
                            {% else %}
                                <span class="badge bg-success">Resolved</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if r.status == 'pending' %}
                            <button onclick="adminAction('{{ r.id }}', 'delete_item')" class="btn btn-danger btn-sm">Delete Item</button>
                            <button onclick="adminAction('{{ r.id }}', 'dismiss')" class="btn btn-secondary btn-sm">Dismiss</button>
                            {% else %}
                                <small>No actions needed</small>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">No active reports. Good job!</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    async function adminAction(reportId, actionType) {
        if(!confirm("Are you sure you want to perform this action?")) return;

        const response = await fetch('/api/admin_action', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ report_id: reportId, action: actionType })
        });

        const data = await response.json();
        if(data.success) {
            alert(data.message);
            location.reload(); // Reload to update table
        } else {
            alert("Error: " + data.message);
        }
    }
</script>

</body>
</html>