<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UniTrade | Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-danger">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">UniTrade Admin Security</a>
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-light btn-sm">Exit to Dashboard</a>
    </div>
</nav>

<div class="container mt-5">
    
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#reports-pane">üö© Reports</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#apps-pane">üëÆ‚Äç‚ôÇÔ∏è Seller Applications</button></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="reports-pane">
            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr><th>Item</th><th>Type</th><th>Reason</th><th>Reporter</th><th>Status</th><th>Actions</th></tr>
                        </thead>
                        <tbody>
                            {% for r in reports %}
                            <tr class="{{ 'table-secondary' if r.status != 'pending' else '' }}">
                                <td>{{ r.item_name }}</td>
                                <td>{{ r.item_type }}</td>
                                <td class="text-danger">{{ r.reason }}</td>
                                <td>{{ r.reporter_email }}</td>
                                <td>{{ r.status }}</td>
                                <td>
                                    {% if r.status == 'pending' %}
                                    <button onclick="adminAction('{{ r.id }}', 'delete_item')" class="btn btn-danger btn-sm">Delete</button>
                                    <button onclick="adminAction('{{ r.id }}', 'dismiss')" class="btn btn-secondary btn-sm">Dismiss</button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% else %}<tr><td colspan="6" class="text-center p-3">No reports.</td></tr>{% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="apps-pane">
            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr><th>Name</th><th>Email</th><th>NRIC</th><th>Matric</th><th>Proof</th><th>Actions</th></tr>
                        </thead>
                        <tbody>
                            {% for a in applications %}
                            <tr>
                                <td>{{ a.real_name }}</td>
                                <td>{{ a.email }}</td>
                                <td>{{ a.nric }}</td>
                                <td>{{ a.matric }}</td>
                                <td><a href="{{ a.id_card_url }}" target="_blank" class="btn btn-sm btn-info text-white">View ID</a></td>
                                <td>
                                    <button onclick="adminAction('{{ a.id }}', 'approve_seller')" class="btn btn-success btn-sm">Approve</button>
                                    <button onclick="adminAction('{{ a.id }}', 'reject_seller')" class="btn btn-danger btn-sm">Reject</button>
                                </td>
                            </tr>
                            {% else %}<tr><td colspan="6" class="text-center p-3">No pending applications.</td></tr>{% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    async function adminAction(reportId, actionType) {
        if(!confirm("Perform this action?")) return;
        const response = await fetch('/api/admin_action', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ report_id: reportId, action: actionType })
        });
        const data = await response.json();
        alert(data.message);
        location.reload();
    }
</script>
</body>
</html>